#### 登录-本地持久化完整调用链与时序图

**功能说明**

用户在登录界面输入账号密码，点击登录后，系统会校验账号密码，若勾选“记住我”，则将账号密码保存到本地数据库。下次启动时自动填充。

**调用链/时序图（文本版）**

```plaintext
用户操作
	│
	▼
MainWindow::on_loginBtn_clicked()
	│
	├─> MainWindow::validateLogin()  // 校验账号密码
	│
	├─> QSqlQuery（保存账号密码到user表，若勾选“记住我”）
	│
	└─> mainPage->show()  // 登录成功进入主页面

程序启动时：
	│
	▼
MainWindow 构造/初始化
	│
	└─> QSqlQuery（读取user表，自动填充账号密码）
```

**VISIO时序图建议**

可用如下参与者绘制：

用户 → MainWindow → QSqlQuery（数据库）

主要消息流：

1. 用户点击登录，MainWindow::on_loginBtn_clicked 校验并保存账号密码
2. 下次启动时，MainWindow 初始化时自动读取账号密码

（可用VISIO绘制标准时序图，或用PlantUML等工具画图）

#### 用户登录校验

**函数名**
validateLogin

**文件名**
mainwindow.cpp

**功能**
用户账号密码校验，向服务器发送登录请求并处理返回，校验通过则设置 user_id。

**记述形式**
bool validateLogin(const QString &username, const QString &password)

**参数**

| 类型           | 变量名   | I/O | 说明     |
| -------------- | -------- | --- | -------- |
| const QString& | username | I   | 用户账号 |
| const QString& | password | I   | 用户密码 |

**返回值**

| 型   | 说明                                   |
| ---- | -------------------------------------- |
| bool | true: 校验通过 `<br>`false: 校验失败 |

#### 聊天功能完整调用链与时序图

**功能说明**

用户在聊天页面输入消息，点击发送后，消息会经过如下完整流程：

1. 发送消息（PageChat::onSendClicked）
2. 通过socket发送到服务器
3. 服务器返回消息（或其他用户发来消息）
4. 客户端PageChat::listenSocket收到socket数据
5. 解析消息，调用ChatDatabase::addMessage持久化到本地数据库
6. 刷新聊天界面，PageChat::loadHistory从数据库读取所有消息并显示

**调用链/时序图（文本版）**

```plaintext
用户操作
	│
	▼
PageChat::onSendClicked()
	│
	├─> socket->write()  // 发送消息到服务器
	│
	▼
服务器
	│
	▼
PageChat::listenSocket()  // 监听socket收到消息
	│
	├─> ChatDatabase::addMessage()  // 消息本地持久化
	│
	└─> PageChat::loadHistory()     // 读取并刷新聊天记录
	│
	▼
界面显示最新聊天内容
```

主要消息流：

1. 用户操作触发onSendClicked
2. PageChat通过QTcpSocket发送消息
3. 服务器返回消息
4. PageChat监听socket，收到消息后addMessage持久化
5. PageChat调用loadHistory刷新界面

根据你的项目文档和代码结构，整理出几个具有代表性的**模块间接口函数**，涵盖主要业务场景。每个接口均包含：功能说明、参数、返回值、调用方法、所在文件。

---


好的，以下是几个代表性接口的表格化整理，仿照你提供的格式：

---

#### 用户登录校验

**函数名**
validateLogin

**文件名**
mainwindow.cpp

**功能**
用户账号密码校验

**记述形式**
bool validateLogin(const QString &username, const QString &password)

**参数**

| 类型           | 变量名   | I/O | 说明     |
| -------------- | -------- | --- | -------- |
| const QString& | username | I   | 用户账号 |
| const QString& | password | I   | 用户密码 |

**返回值**

| 型   | 说明                                  |
| ---- | ------------------------------------- |
| bool | true: 校验通过`<br>`false: 校验失败 |

---

#### 预约挂号请求

**函数名**
requestAppointment

**文件名**
page_appointment.cpp

**功能**
发送预约挂号请求到服务器

**记述形式**
void requestAppointment(const QString &department, const QString &doctor, const QString &time)

**参数**

| 类型           | 变量名     | I/O | 说明     |
| -------------- | ---------- | --- | -------- |
| const QString& | department | I   | 科室名称 |
| const QString& | doctor     | I   | 医生名称 |
| const QString& | time       | I   | 预约时间 |

**返回值**

| 型   | 说明                         |
| ---- | ---------------------------- |
| void | 无（异步，结果通过信号返回） |

---

#### 聊天消息发送

**函数名**
onSendClicked

**文件名**
page_chat.cpp

**功能**
发送聊天消息到服务器

**记述形式**
void onSendClicked()

**参数**

| 类型 | 变量名 | I/O | 说明 |
| ---- | ------ | --- | ---- |
| void | -      | -   | -    |

**返回值**

| 型   | 说明 |
| ---- | ---- |
| void | 无   |

---

#### 聊天消息本地存储

**函数名**
insertMessage

**文件名**
chatdatabase.cpp

**功能**
将聊天消息插入本地数据库

**记述形式**
bool insertMessage(const ChatMessage &msg)

**参数**

| 类型               | 变量名 | I/O | 说明           |
| ------------------ | ------ | --- | -------------- |
| const ChatMessage& | msg    | I   | 聊天消息结构体 |

**返回值**

| 型   | 说明                          |
| ---- | ----------------------------- |
| bool | true: 成功`<br>`false: 失败 |

---
